<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æ¨ç®±å­ - ç§»åŠ¨ç«¯ä¼˜åŒ–ç‰ˆ</title>
  <style>
    /* â€”â€” å…¨å±€è®¾ç½® â€”â€” */
    :root {
      --bg-color: #f0f2f5;
      --control-bg: rgba(255, 255, 255, 0.95);
      --primary-color: #007AFF;
      --btn-active: #0056b3;
    }

    body {
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden; /* ç¦æ­¢æ•´ä¸ªé¡µé¢æ»šåŠ¨ */
      user-select: none;
      -webkit-user-select: none;
    }

    /* â€”â€” é¡¶éƒ¨åŒºåŸŸï¼šæ ‡é¢˜ä¸å…³å¡é€‰æ‹© â€”â€” */
    header {
      padding: 10px 0;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      z-index: 10;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    h1 {
      margin: 5px 0 5px 0;
      font-size: 1.1rem;
      color: #333;
      text-align: center;
    }

    /* å…³å¡é€‰æ‹©å™¨ï¼šä¼˜åŒ–æ»šåŠ¨æ˜¾ç¤º */
    #level-scroll-container {
      display: flex;
      overflow-x: auto;
      gap: 12px;
      padding: 5px 15px 15px 15px; /* å¢åŠ åº•éƒ¨paddingé˜²æ­¢é˜´å½±è¢«åˆ‡ */
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    #level-scroll-container::-webkit-scrollbar {
      display: none;
    }

    .level-btn {
      flex: 0 0 auto;
      padding: 8px 18px;
      font-size: 14px;
      border-radius: 20px;
      border: 1px solid #eee;
      background-color: #fff;
      color: #555;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: all 0.2s;
    }

    .level-btn.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
      box-shadow: 0 3px 8px rgba(0,122,255,0.3);
      transform: translateY(-1px);
    }

    /* â€”â€” æ¸¸æˆä¸»åŒºåŸŸ â€”â€” */
    #game-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
      background-color: #e8e8e8;
      margin: 10px;
      border-radius: 12px;
      box-shadow: inset 0 0 15px rgba(0,0,0,0.05);
    }

    #game-board {
      display: grid;
      gap: 1px;
      background-color: #bbb;
      /* å®½é«˜ç”± JS åŠ¨æ€è®¡ç®— */
    }

    /* çŠ¶æ€æç¤ºæµ®å±‚ */
    #status-overlay {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 15px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 20;
      white-space: nowrap;
    }
    #status-overlay.show {
      opacity: 1;
    }

    /* â€”â€” åœ°å›¾å…ƒç´ æ ·å¼ â€”â€” */
    .tile {
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative; /* å…³é”®ï¼šç”¨äºç»å¯¹å®šä½å­å…ƒç´  */
    }

    /* å¢™å£ */
    .wall {
      background-color: #555;
      background-image: linear-gradient(45deg, #666 25%, transparent 25%, transparent 75%, #666 75%, #666),
                        linear-gradient(45deg, #666 25%, transparent 25%, transparent 75%, #666 75%, #666);
      background-size: 12px 12px;
    }
    /* å¢™å¤– */
    .outside { background-color: transparent; }
    /* åœ°æ¿ */
    .floor { background-color: #fffaf0; }
    
    /* ç›®æ ‡ç‚¹ï¼ˆçº¢ç‚¹ï¼‰ï¼šç»å¯¹å®šä½åœ¨åº•å±‚ */
    .goal::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50%;   /* æ›´å¤§ */
      height: 50%;  /* æ›´å¤§ */
      background-color: #ff3333;
      border-radius: 50%;
      z-index: 1; /* åœ¨æœ€åº•å±‚ï¼ˆåœ°æ¿ä¹‹ä¸Šï¼Œç‰©ä½“ä¹‹ä¸‹ï¼‰ */
      opacity: 0.6;
    }

    /* ç©å®¶ï¼šå·¥äºº */
    .player::before {
      content: "ğŸ‘·"; /* å·¥äºº Emoji */
      position: relative;
      z-index: 5; /* ç¡®ä¿åœ¨çº¢ç‚¹ä¸Šé¢ */
      /* font-size ç”± JS åŠ¨æ€æ§åˆ¶ */
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
    }

    /* ç®±å­ */
    .box::before {
      content: "ğŸ“¦";
      position: relative;
      z-index: 5;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
    }

    /* ç®±å­åœ¨ç›®æ ‡ç‚¹ä¸Šï¼šç»¿åº•ï¼Œä¾ç„¶æ˜¯ç®±å­ */
    .box-on-goal {
      background-color: #ccffcc; /* å˜ç»¿ */
    }
    .box-on-goal::before {
      content: "ğŸ“¦"; /* ä¿æŒç®±å­æ ·å­ */
      position: relative;
      z-index: 5;
      filter: drop-shadow(0 0 5px rgba(0,255,0,0.5));
    }

    /* â€”â€” åº•éƒ¨æ§åˆ¶åŒº â€”â€” */
    #controls-area {
      background-color: var(--control-bg);
      padding: 10px 20px 20px 20px; /* è°ƒæ•´åº•éƒ¨padding */
      border-top-left-radius: 25px;
      border-top-right-radius: 25px;
      box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      backdrop-filter: blur(10px);
    }

    /* åŠŸèƒ½æŒ‰é’®è¡Œ */
    .action-row {
      display: flex;
      width: 100%;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .func-btn {
      padding: 10px 18px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      background-color: #f1f3f5;
      color: #495057;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 0 #dee2e6;
    }
    .func-btn:active { transform: translateY(2px); box-shadow: none; }
    .btn-undo { color: #d63384; background-color: #fff0f6; box-shadow: 0 2px 0 #fcc2d7; }
    .btn-restart { color: #fd7e14; background-color: #fff4e6; box-shadow: 0 2px 0 #ffe8cc; }

    /* æ–¹å‘ç›˜å¸ƒå±€ */
    #dpad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 12px;
      width: 200px;
      height: 140px;
    }

    .dpad-btn {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 16px;
      background-color: #fff;
      color: #333;
      font-size: 26px;
      box-shadow: 0 4px 0 #e9ecef, 0 2px 5px rgba(0,0,0,0.05);
      transition: all 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .dpad-btn:active {
      transform: translateY(4px);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
      background-color: #f8f9fa;
    }

    /* ç»Ÿä¸€æ‰€æœ‰æŒ‰é’®æ ·å¼ï¼Œç§»é™¤ btn-up çš„ç‰¹æ®Šé¢œè‰² */
    #btn-up { grid-column: 2; grid-row: 1; }
    #btn-left { grid-column: 1; grid-row: 2; }
    #btn-down { grid-column: 2; grid-row: 2; }
    #btn-right { grid-column: 3; grid-row: 2; }

    /* â€”â€” è‡ªå®šä¹‰åœ°å›¾æ¨¡æ€æ¡† â€”â€” */
    #custom-map-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 100;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(3px);
    }
    .modal-content {
      background: white;
      padding: 24px;
      border-radius: 20px;
      width: 85%;
      max-width: 400px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    textarea {
      width: 100%;
      height: 120px;
      margin: 15px 0;
      font-family: monospace;
      padding: 10px;
      border: 2px solid #eee;
      border-radius: 10px;
      box-sizing: border-box;
      resize: none;
    }
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

  </style>
</head>
<body>

  <!-- å¤´éƒ¨ -->
  <header>
    <h1>æ¨ç®±å­</h1>
    <div id="level-scroll-container">
      <!-- å…³å¡æŒ‰é’®ç”± JS ç”Ÿæˆ -->
    </div>
  </header>

  <!-- æ¸¸æˆåŒºåŸŸ -->
  <div id="game-container">
    <div id="game-board"></div>
    <div id="status-overlay"></div> <!-- èƒœåˆ©æç¤º -->
  </div>

  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <div id="controls-area">
    <div class="action-row">
      <button class="func-btn extra-btn" id="btn-show-custom">ğŸ—ºï¸ è‡ªå®šä¹‰</button>
      <div style="flex:1"></div>
      <button class="func-btn btn-undo" id="btn-undo">â†©ï¸ æ’¤å›</button>
      <button class="func-btn btn-restart" id="btn-restart">ğŸ”„ é‡ç©</button>
    </div>

    <div id="dpad">
      <!-- ç©ºå ä½ -->
      <div style="grid-column: 1; grid-row: 1;"></div>
      <button class="dpad-btn" id="btn-up">â–²</button>
      <div style="grid-column: 3; grid-row: 1;"></div>
      
      <button class="dpad-btn" id="btn-left">â—€</button>
      <button class="dpad-btn" id="btn-down">â–¼</button>
      <button class="dpad-btn" id="btn-right">â–¶</button>
    </div>

    <!-- åº•éƒ¨ç‰ˆæƒä¿¡æ¯ -->
    <div class="footer-info">@å­™ç»´åˆšæ•™è‚²ç ”ç©¶é™¢</div>
  </div>

  <!-- è‡ªå®šä¹‰åœ°å›¾å¼¹çª— -->
  <div id="custom-map-modal">
    <div class="modal-content">
      <h3 style="margin:0">è¾“å…¥è‡ªå®šä¹‰åœ°å›¾</h3>
      <textarea id="map-input" placeholder="è¯·åœ¨æ­¤ç²˜è´´åœ°å›¾æ•°æ®...&#10;######&#10;#@ $.#&#10;######"></textarea>
      <div class="modal-actions">
        <button class="func-btn" style="background:#f1f3f5" onclick="document.getElementById('custom-map-modal').style.display='none'">å–æ¶ˆ</button>
        <button class="func-btn" style="background:var(--primary-color);color:white;box-shadow:0 4px 0 #0056b3" id="btn-load-map">åŠ è½½</button>
      </div>
    </div>
  </div>

<script>
/** å…³å¡æ•°æ® */
const levels = [
  // å…³å¡ 1
  `######
#---.#
#-$$.#
#-$@.#
######`,
  // å…³å¡ 2
  `#####_
#..-#_
#-@$##
#-$--#
##---#
_#####`,
  // å…³å¡ 3
  `######
#----#
#-$@.#
#-#$.#
#-$-.#
######`,
  // å…³å¡ 4
  `__#####_
###---#_
#.@$--#_
###-$.#_
#.##$-#_
#-#-.-##
#$-*$$.#
#---.--#
########`,
  // å…³å¡ 5
  `____#####__________
____#---#__________
____#$--#__________
__###--$##_________
__#--$-$-#_________
###-#-##-#___######
#---#-##-#####--..#
#-$--$----------..#
#####-###-#@##--..#
____#-----#########
____#######________`,
  // å…³å¡ 6
  `############__
#..--#-----###
#..--#-$--$--#
#..--#$####--#
#..----@-##--#
#..--#-#--$-##
######-##$-$-#
__#-$--$-$-$-#
__#----#-----#
__############`,
  // å…³å¡ 7
  `#####__
#---#__
#---###
#$$$@-#
#...--#
#######`,
  // å…³å¡ 8
  `####__
#--#__
#--#__
#--###
#.$$@#
#--.-#
#--###
####__`,
  // å…³å¡ 9
  `#######
#-----#
#-$$$.#
##-#@.#
_#-#-.#
_#--#-#
_##---#
__#####`,
  // å…³å¡ 10
  `_________#####
_________#---#
##########-#-#
#.-----#--$--#
#.--@--#----##
#.#-#######--#
#---------$$-#
##--#####----#
_####___######`,
  // å…³å¡ 11
  `_#######__
_#-----###
##-###$--#
#--..-$--#
#--.##$-##
###-#-@##_
__#---##__
__#####___`,
  // å…³å¡ 12
  `######____
#----#####
#---$-$--#
###$...@-#
__#--#####
__####____`,
  // å…³å¡ 13
  `#######
#@-$.-#
#--$--#
#.-$-$#
#-.-#.#
#######`
];

/** å…¨å±€çŠ¶æ€ */
let floorMap = [], objMap = [];
let rows = 0, cols = 0;
let playerX = 0, playerY = 0;
let gameWon = false;
let undoStack = [];
let currentLevelData = "";

/** åˆå§‹åŒ–ç•Œé¢ */
function initUI() {
  const container = document.getElementById('level-scroll-container');
  
  // ç”Ÿæˆå…³å¡æŒ‰é’®
  levels.forEach((lvl, index) => {
    const btn = document.createElement('button');
    btn.className = 'level-btn';
    btn.textContent = `ç¬¬ ${index + 1} å…³`; // ç®€åŒ–æ–‡æ¡ˆ
    btn.onclick = () => {
      document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      loadLevelFromText(lvl);
      // è‡ªåŠ¨æ»šåŠ¨åˆ°ä¸­é—´ï¼ˆæå‡ä½“éªŒï¼‰
      btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    };
    container.appendChild(btn);
  });

  // é»˜è®¤åŠ è½½ç¬¬ä¸€å…³
  container.children[0].classList.add('active');
  loadLevelFromText(levels[0]);
}

/** åŠ è½½å…³å¡ */
function loadLevelFromText(mapText) {
  gameWon = false;
  undoStack = [];
  currentLevelData = mapText;
  showStatus("");

  const lines = mapText.replace(/\r/g, "").split("\n").filter(l => l.trim().length > 0);
  rows = lines.length;
  cols = 0;
  lines.forEach(l => { if (l.length > cols) cols = l.length; });

  floorMap = [];
  objMap = [];
  playerX = -1;
  playerY = -1;

  for (let y = 0; y < rows; y++) {
    floorMap[y] = [];
    objMap[y] = [];
    const line = lines[y] || "";
    for (let x = 0; x < cols; x++) {
      let ch = line[x] || " ";
      if(ch === '"') ch = " ";

      if (ch === '#') { floorMap[y][x] = '#'; objMap[y][x] = ' '; }
      else if (ch === '_') { floorMap[y][x] = '_'; objMap[y][x] = ' '; }
      else if (ch === '.') { floorMap[y][x] = '.'; objMap[y][x] = ' '; }
      else if (ch === '@') { floorMap[y][x] = '-'; objMap[y][x] = '@'; playerX = x; playerY = y; }
      else if (ch === '$') { floorMap[y][x] = '-'; objMap[y][x] = '$'; }
      else if (ch === '*') { floorMap[y][x] = '.'; objMap[y][x] = '$'; }
      else { floorMap[y][x] = '-'; objMap[y][x] = ' '; }
    }
  }

  drawBoard();
  adjustBoardSize();
}

/** ç»˜åˆ¶åœ°å›¾ */
function drawBoard() {
  const board = document.getElementById("game-board");
  board.innerHTML = "";
  board.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
  board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const tile = document.createElement("div");
      tile.className = "tile";
      
      const fch = floorMap[y][x];
      const och = objMap[y][x];

      // åº•å±‚ï¼šå¢™ã€åœ°ã€ç»ˆç‚¹
      if (fch === '#') tile.classList.add("wall");
      else if (fch === '_') tile.classList.add("outside");
      else if (fch === '-') tile.classList.add("floor");
      else if (fch === '.') tile.classList.add("goal"); // ç»ˆç‚¹ç°åœ¨æ˜¯ç»å¯¹å®šä½çš„å­å…ƒç´ 

      // ä¸Šå±‚ï¼šäººã€ç®±å­
      if (och === '@') tile.classList.add("player");
      else if (och === '$') {
        tile.classList.add(fch === '.' ? "box-on-goal" : "box");
      }

      board.appendChild(tile);
    }
  }
  
  // é‡æ–°è®¡ç®—å­—ä½“å¤§å°ï¼Œç¡®ä¿æ–°åŠ çš„ emoji å¤§å°æ­£ç¡®
  requestAnimationFrame(adjustBoardSize);
  checkWin();
}

/** é€‚é…å±å¹•å°ºå¯¸ & åŠ¨æ€å­—ä½“å¤§å° */
function adjustBoardSize() {
  const container = document.getElementById('game-container');
  const board = document.getElementById('game-board');
  
  const maxWidth = container.clientWidth;
  const maxHeight = container.clientHeight;
  
  const sizeByWidth = Math.floor(maxWidth / cols);
  const sizeByHeight = Math.floor(maxHeight / rows);
  const cellSize = Math.min(sizeByWidth, sizeByHeight, 60); // æœ€å¤§60px

  board.style.width = `${cellSize * cols}px`;
  board.style.height = `${cellSize * rows}px`;
  
  // åŠ¨æ€è°ƒæ•´ Emoji å¤§å°ï¼šå æ ¼å­çš„ 80%
  const tiles = document.querySelectorAll('.tile');
  const fontSize = Math.floor(cellSize * 0.8) + "px";
  
  tiles.forEach(t => {
      // åªæœ‰ä¼ªå…ƒç´ éœ€è¦å­—ä½“å¤§å°ï¼Œä½†é€šè¿‡çˆ¶å…ƒç´ æ§åˆ¶æœ€æ–¹ä¾¿
      t.style.fontSize = fontSize;
  });
}

/** èƒœåˆ©æ£€æµ‹ */
function checkWin() {
  let hasBox = false;
  let allDone = true;
  for(let y=0; y<rows; y++){
      for(let x=0; x<cols; x++){
          if(objMap[y][x] === '$' && floorMap[y][x] !== '.') {
              allDone = false;
              break;
          }
      }
      if(!allDone) break;
  }

  if (allDone && !gameWon) {
    gameWon = true;
    showStatus("ğŸ‰ æ­å–œï¼å®Œç¾é€šå…³ï¼");
    if(navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 200]);
  }
}

function showStatus(msg) {
  const el = document.getElementById("status-overlay");
  el.textContent = msg;
  if(msg) el.classList.add('show');
  else el.classList.remove('show');
}

/** ç§»åŠ¨é€»è¾‘ */
function movePlayer(dx, dy) {
  if (gameWon) return;

  const newX = playerX + dx;
  const newY = playerY + dy;

  if (newY < 0 || newY >= rows || newX < 0 || newX >= cols) return;
  if (floorMap[newY][newX] === '#' || floorMap[newY][newX] === '_') return;

  const targetObj = objMap[newY][newX];
  let moveRecord = {
    px: playerX, py: playerY, nx: newX, ny: newY,
    box: null 
  };

  if (targetObj === ' ') {
    objMap[playerY][playerX] = ' ';
    objMap[newY][newX] = '@';
    playerX = newX; playerY = newY;
    undoStack.push(moveRecord);
  } else if (targetObj === '$') {
    const boxNextX = newX + dx;
    const boxNextY = newY + dy;
    if (boxNextY < 0 || boxNextY >= rows || boxNextX < 0 || boxNextX >= cols) return;
    if (["#", "_"].includes(floorMap[boxNextY][boxNextX])) return;
    if (["$", "@"].includes(objMap[boxNextY][boxNextX])) return;

    objMap[playerY][playerX] = ' ';
    objMap[newY][newX] = '@';
    objMap[boxNextY][boxNextX] = '$';
    
    moveRecord.box = { ox: newX, oy: newY, nx: boxNextX, ny: boxNextY };
    playerX = newX; playerY = newY;
    undoStack.push(moveRecord);
  }

  if(navigator.vibrate) navigator.vibrate(15); // è½»å¾®éœ‡åŠ¨åé¦ˆ
  drawBoard();
}

/** æ’¤å› */
function undoMove() {
  if (undoStack.length === 0) return;
  const last = undoStack.pop();

  objMap[last.ny][last.nx] = ' ';
  objMap[last.py][last.px] = '@';
  playerX = last.px;
  playerY = last.py;

  if (last.box) {
    objMap[last.box.nx][last.box.ny] = ' ';
    objMap[last.box.ox][last.box.oy] = '$';
  }

  gameWon = false;
  showStatus("");
  drawBoard();
}

/* ================= äº‹ä»¶ç›‘å¬ ================= */
window.addEventListener("resize", adjustBoardSize);

document.addEventListener("keydown", (e) => {
  if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(e.key)) {
    e.preventDefault();
  }
  if (e.key === "ArrowUp") movePlayer(0, -1);
  else if (e.key === "ArrowDown") movePlayer(0, 1);
  else if (e.key === "ArrowLeft") movePlayer(-1, 0);
  else if (e.key === "ArrowRight") movePlayer(1, 0);
});

const bindBtn = (id, dx, dy) => {
  const btn = document.getElementById(id);
  btn.addEventListener("touchstart", (e) => { e.preventDefault(); movePlayer(dx, dy); });
  btn.addEventListener("click", () => movePlayer(dx, dy));
};
bindBtn("btn-up", 0, -1);
bindBtn("btn-down", 0, 1);
bindBtn("btn-left", -1, 0);
bindBtn("btn-right", 1, 0);

document.getElementById("btn-undo").onclick = undoMove;
document.getElementById("btn-restart").onclick = () => loadLevelFromText(currentLevelData);

// è‡ªå®šä¹‰åœ°å›¾
const modal = document.getElementById("custom-map-modal");
document.getElementById("btn-show-custom").onclick = () => {
  modal.style.display = "flex";
  document.getElementById("map-input").focus();
};
document.getElementById("btn-load-map").onclick = () => {
  const txt = document.getElementById("map-input").value;
  if(txt.trim()) {
    loadLevelFromText(txt);
    modal.style.display = "none";
    document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
  }
};

// è§¦æ‘¸æ»‘åŠ¨
let touchStartX = 0;
let touchStartY = 0;
const gameContainer = document.getElementById("game-container");

gameContainer.addEventListener('touchstart', function(e) {
    touchStartX = e.changedTouches[0].screenX;
    touchStartY = e.changedTouches[0].screenY;
    e.preventDefault();
}, {passive: false});

gameContainer.addEventListener('touchend', function(e) {
    let touchEndX = e.changedTouches[0].screenX;
    let touchEndY = e.changedTouches[0].screenY;
    handleSwipe(touchStartX, touchStartY, touchEndX, touchEndY);
    e.preventDefault();
}, {passive: false});

function handleSwipe(sx, sy, ex, ey) {
    let dx = ex - sx;
    let dy = ey - sy;
    if (Math.abs(dx) < 30 && Math.abs(dy) < 30) return;
    if (Math.abs(dx) > Math.abs(dy)) {
        movePlayer(dx > 0 ? 1 : -1, 0);
    } else {
        movePlayer(0, dy > 0 ? 1 : -1);
    }
}

// å¯åŠ¨
initUI();

</script>
</body>
</html>
